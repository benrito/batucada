{% load l10n_tags %}
{% load voting_tags %}
{% score_for_object submission as score %}
{% vote_by_user user on submission as vote %}

  <div class="post-contents" data-unique="{{ submission.pk }}">
    <div class="details">
    <h2 class="title">{{ submission.title }}</h2>
    <div class="post-body">
      {% if not full_data %}
        {{ submission.summary }}
      {% else %}
        {{ submission.summary|truncatewords_html:40 }}
      {% endif %}
      <p><a class="more" href="{% locale_url  submission_show slug=challenge.slug submission_id=submission.pk %}">Read the full idea</a>.</p>
    </div>
    </div>
{% if challenge.allow_voting %}
    <div class="voting">
        <h3>Voting</h3>
      <p>Total likes for this idea: <span class="score">{{ score.score|default:0 }}</span></p>
      {% if user.is_authenticated %}
      <form method="post" id="upvote-{{ submission.pk }}" action="{% if vote and vote.is_upvote %}{% locale_url submission_vote object_id=submission.pk direction='clear' %}{% else %}{% locale_url submission_vote object_id=submission.pk direction='up' %}{% endif %}">
        {% csrf_token %}
        <input type="hidden" name="next" value="{% if profile.voter_details.count %}{% locale_url challenges_show slug=challenge.slug %}{% else %}{% locale_url submissions_voter_details submission_id=submission.pk %}{% endif %}" />
        {% if not vote or not vote.is_upvote %}
            <p><strong>What do you think?</strong></p>
            <input class="trigger vote" type="submit" value="This is a great idea" />
        {% else %}
            <p><strong>You liked this idea</strong></p>
            <input type="submit" class="trigger clear" value="Cancel my vote" />
        {% endif %}
        </form>
        {% endif %}
    </div>
    {% endif %}

  </div> <!-- /div.post-container -->
